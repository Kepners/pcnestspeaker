###############################################
# MediaMTX Configuration for PC Nest Speaker
# Optimized for low-latency audio-only WebRTC streaming
###############################################

# Logging
logLevel: info
logDestinations: [stdout]

# Timeouts
readTimeout: 10s
writeTimeout: 10s
writeQueueSize: 512

###############################################
# Authentication - allow all for local use
###############################################
authMethod: internal
authInternalUsers:
- user: any
  pass:
  ips: []
  permissions:
  - action: publish
    path:
  - action: read
    path:
- user: any
  pass:
  ips: ['127.0.0.1', '::1']
  permissions:
  - action: api
  - action: metrics

###############################################
# Control API - enabled for monitoring
###############################################
api: yes
apiAddress: :9997
apiEncryption: no
apiAllowOrigins: ['*']

###############################################
# RTSP server - receives FFmpeg stream
###############################################
rtsp: yes
rtspTransports: [tcp]
rtspEncryption: "no"
rtspAddress: :8554

###############################################
# RTMP server - disabled (not needed)
###############################################
rtmp: no

###############################################
# HLS server - disabled (not needed)
###############################################
hls: no

###############################################
# WebRTC server - serves to Cast receiver
###############################################
webrtc: yes
webrtcAddress: :8889
webrtcEncryption: no
webrtcAllowOrigins: ['*']
# Auto-detect local IP - app will inject correct IP at startup
webrtcIPsFromInterfaces: yes
webrtcIPsFromInterfacesList: []
webrtcAdditionalHosts: ['192.168.50.48']
webrtcLocalUDPAddress: :8189
webrtcLocalTCPAddress: :8189
# Increase timeouts for Nest speakers which have slow ICE
webrtcHandshakeTimeout: 120s
webrtcTrackGatherTimeout: 60s
webrtcSTUNGatherTimeout: 60s
# ICE servers for NAT traversal
# Google STUN + Open Relay TURN for fallback relay
# Include multiple TURN options to ensure connectivity
webrtcICEServers2:
  - url: stun:stun.l.google.com:19302
  - url: stun:stun1.l.google.com:19302
  - url: stun:stun2.l.google.com:19302
  - url: turn:openrelay.metered.ca:80
    username: openrelayproject
    password: openrelayproject
  - url: turn:openrelay.metered.ca:443
    username: openrelayproject
    password: openrelayproject
  - url: turn:openrelay.metered.ca:443?transport=tcp
    username: openrelayproject
    password: openrelayproject

###############################################
# SRT server - disabled (not needed)
###############################################
srt: no

###############################################
# Path configuration
###############################################
pathDefaults:
  source: publisher
  sourceOnDemand: no
  maxReaders: 0
  overridePublisher: yes
  record: no

# Define paths for our streams
paths:
  pcaudio:
    source: publisher

  # Stereo separation paths
  left:
    source: publisher

  right:
    source: publisher
