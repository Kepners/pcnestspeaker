###############################################
# MediaMTX Configuration for PC Nest Speaker
# Optimized for low-latency audio-only WebRTC streaming
###############################################

# Logging
logLevel: info
logDestinations: [stdout]

# Timeouts - balanced for low latency + stability
readTimeout: 5s
writeTimeout: 5s
writeQueueSize: 64

###############################################
# Authentication - allow all for local use
###############################################
authMethod: internal
authInternalUsers:
- user: any
  pass:
  ips: []
  permissions:
  - action: publish
    path:
  - action: read
    path:
- user: any
  pass:
  ips: ['127.0.0.1', '::1']
  permissions:
  - action: api
  - action: metrics

###############################################
# Control API - enabled for monitoring
###############################################
api: yes
apiAddress: :9997
apiEncryption: no
apiAllowOrigins: ['*']

###############################################
# RTSP server - receives FFmpeg stream
###############################################
rtsp: yes
rtspTransports: [tcp]
rtspEncryption: "no"
rtspAddress: :8554

###############################################
# RTMP server - disabled (not needed)
###############################################
rtmp: no

###############################################
# HLS server - for TV devices (Shield, Chromecast)
# TVs don't support WebRTC, so we use HLS instead
###############################################
hls: yes
hlsAddress: :8888
hlsEncryption: no
hlsAllowOrigin: '*'
hlsSegmentCount: 3
hlsSegmentDuration: 500ms
hlsPartDuration: 100ms
hlsSegmentMaxSize: 50M

###############################################
# WebRTC server - serves to Cast receiver
###############################################
webrtc: yes
webrtcAddress: :8889
webrtcEncryption: no
webrtcAllowOrigins: ['*']
# DISABLE auto-detect - too many dead interfaces with 169.254.x.x cause ICE timeouts
# App injects the correct IP into webrtcAdditionalHosts at startup
webrtcIPsFromInterfaces: no
webrtcIPsFromInterfacesList: []
webrtcAdditionalHosts: ['192.168.50.48']
webrtcLocalUDPAddress: 192.168.50.48:8189
webrtcLocalTCPAddress: 192.168.50.48:8189
# Reduced timeouts for faster testing (increase later if needed)
webrtcHandshakeTimeout: 30s
webrtcTrackGatherTimeout: 10s
webrtcSTUNGatherTimeout: 5s
# ICE servers - EMPTY for local network (no STUN needed on same LAN)
# Re-enable these for remote/NAT scenarios
webrtcICEServers2: []

###############################################
# SRT server - disabled (not needed)
###############################################
srt: no

###############################################
# Path configuration
###############################################
pathDefaults:
  source: publisher
  sourceOnDemand: no
  maxReaders: 0
  overridePublisher: yes
  record: no

# Define paths for our streams
paths:
  pcaudio:
    source: publisher

  # Stereo separation paths
  left:
    source: publisher

  right:
    source: publisher
